{"version":3,"file":"validation-token.model.js","sourceRoot":"","sources":["../../../src/modules/user/validation-token.model.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,kDAA8C;AAC9C,8BAAoE;AACpE,oDAA4B;AAC5B,oDAA4B;AAC5B,IAAI,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC,8BAA8B,CAAC,CAAC;AAG7D,IAAa,oBAAoB,4BAAjC,MAAa,oBAAqB,SAAQ,SAAK;IA8D7C;QACE,KAAK,EAAE,CAAC;QA1DH,UAAK,GAAoB,IAAI,CAAC;QAK9B,SAAI,GAAW,EAAE,CAAC;QAMlB,UAAK,GAAW,EAAE,CAAC;QAKnB,cAAS,GAAW,EAAE,CAAC;QAKvB,eAAU,GAAW,EAAE,CAAC;QAMxB,mBAAc,GAAY,KAAK,CAAC;QAMhC,oBAAe,GAAY,KAAK,CAAC;QAMjC,YAAO,GAAS,IAAI,IAAI,EAAE,CAAC;QAY3B,gBAAW,GAAY,KAAK,CAAC;QAI7B,SAAI,GAAe,EAAE,CAAC;QAI3B,IAAI,CAAC,KAAK,GAAG,sBAAoB,CAAC;IACpC,CAAC;IAED,IAAI,CAAC,IAAY,EAAE,WAAmB,EAAE,EAAE,eAAuD,OAAO;QACtG,UAAU;QACV,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,GAAG,GAAG,EAAE,CAAC;QACb,IAAI,CAAC,KAAK,GAAG,gBAAM,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;QAClF,GAAG,GAAG,CAAC,CAAC;QACR,IAAI,CAAC,SAAS,GAAG,gBAAM,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;QACtF,IAAI,CAAC,UAAU,GAAG,gBAAM,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;QACvF,IAAI,CAAC,OAAO,GAAG,gBAAM,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC,MAAM,EAAE,CAAC;IAC/D,CAAC;CACF,CAAA;AAxEC;IAHC,QAAI,CAAC,KAAK,CAAC,EAAC,KAAK,EAAE,oBAAQ,EAAC,CAAC;IAC7B,MAAE,CAAC,UAAU;IACb,YAAQ,CAAC,QAAQ;mDACmB;AAKrC;IAHC,QAAI,CAAC,MAAM;IACX,MAAE,CAAC,UAAU;IACb,YAAQ,CAAC,QAAQ;kDACO;AAMzB;IAJC,QAAI,CAAC,MAAM;IACX,MAAE,CAAC,UAAU;IACb,MAAE,CAAC,MAAM;IACT,YAAQ,CAAC,QAAQ;mDACQ;AAK1B;IAHC,QAAI,CAAC,MAAM;IACX,MAAE,CAAC,UAAU;IACb,YAAQ,CAAC,QAAQ;uDACY;AAK9B;IAHC,QAAI,CAAC,MAAM;IACX,MAAE,CAAC,UAAU;IACb,YAAQ,CAAC,QAAQ;wDACa;AAM/B;IAJC,QAAI,CAAC,OAAO;IACZ,MAAE,CAAC,UAAU;IACb,MAAE,CAAC,MAAM;IACT,YAAQ,CAAC,QAAQ;4DACqB;AAMvC;IAJC,QAAI,CAAC,OAAO;IACZ,MAAE,CAAC,UAAU;IACb,MAAE,CAAC,MAAM;IACT,YAAQ,CAAC,QAAQ;6DACsB;AAMxC;IAJC,QAAI,CAAC,IAAI;IACT,MAAE,CAAC,UAAU;IACb,MAAE,CAAC,MAAM;IACT,YAAQ,CAAC,QAAQ;qDACgB;AAIlC;IAFC,QAAI,CAAC,GAAG;IACR,MAAE,CAAC,UAAU;kDACI;AAIlB;IAFC,QAAI,CAAC,GAAG;IACR,MAAE,CAAC,UAAU;uDACS;AAIvB;IAFC,QAAI,CAAC,OAAO;IACZ,MAAE,CAAC,UAAU;yDACsB;AAIpC;IAFC,QAAI,CAAC,GAAG;IACR,MAAE,CAAC,UAAU;kDACe;AA5DlB,oBAAoB;IADhC,SAAK,CAAC,kBAAkB,CAAC;GACb,oBAAoB,CA6EhC;AA7EY,oDAAoB","sourcesContent":["import { AppModel } from './../app/app.model';\nimport { model, Model, type, io, validate, ObjectId } from '../../';\nimport crypto from 'crypto';\nimport moment from 'moment';\nlet debug = require('debug')('app:models:validation-tokens');\n\n@model('validationTokens')\nexport class ValidationTokenModel extends Model {\n\n  @type.model({model: AppModel})\n  @io.toDocument\n  @validate.required\n  public appId: ObjectId | null = null;\n\n  @type.string\n  @io.toDocument\n  @validate.required\n  public type: string = '';\n\n  @type.string\n  @io.toDocument\n  @io.output\n  @validate.required\n  public token: string = '';\n\n  @type.string\n  @io.toDocument\n  @validate.required\n  public emailCode: string = '';\n\n  @type.string\n  @io.toDocument\n  @validate.required\n  public mobileCode: string = '';\n\n  @type.boolean\n  @io.toDocument\n  @io.output\n  @validate.required\n  public emailValidated: boolean = false;\n\n  @type.boolean\n  @io.toDocument\n  @io.output\n  @validate.required\n  public mobileValidated: boolean = false;\n\n  @type.date\n  @io.toDocument\n  @io.output\n  @validate.required\n  public expires: Date = new Date();\n\n  @type.any\n  @io.toDocument\n  public data: null;\n\n  @type.any\n  @io.toDocument\n  public extraData: null;\n\n  @type.boolean\n  @io.toDocument\n  public userCreated: boolean = false;\n\n  @type.any\n  @io.toDocument\n  public logs: Array<any> = [];\n\n  constructor() {\n    super();\n    this.model = ValidationTokenModel;\n  }\n\n  init(type: string, validity: number = 48, validityUnit: 'hours' | 'minutes' | 'days' | 'weeks' = 'hours') {\n    //super();\n    this.type = type;\n    let len = 32;\n    this.token = crypto.randomBytes(Math.ceil(len / 2)).toString('hex').slice(0, len);\n    len = 6;\n    this.emailCode = crypto.randomBytes(Math.ceil(len / 2)).toString('hex').slice(0, len);\n    this.mobileCode = crypto.randomBytes(Math.ceil(len / 2)).toString('hex').slice(0, len);\n    this.expires = moment().add(validity, validityUnit).toDate();\n  }\n}"]}