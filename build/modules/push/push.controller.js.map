{"version":3,"file":"push.controller.js","sourceRoot":"","sources":["../../../src/modules/push/push.controller.ts"],"names":[],"mappings":";;AAAA,6DAAoE;AACpE,+DAA2D;AAC3D,4DAAwD;AACxD,2DAAsD;AACtD,uEAAkE;AAClE,6EAAwE;AACxE,qCAAiC;AAEjC,IAAI,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC,qBAAqB,CAAC,CAAC;AAEpD,MAAM,MAAM,GAAW,gBAAM,EAAE,CAAC;AAEhC,IAAI,sBAAsB,GAAG,IAAI,qDAAwB,CAAC,+CAAqB,CAAC,CAAC;AACjF,IAAI,gBAAgB,GAAG,IAAI,qDAAwB,CAAC,mCAAe,CAAC,CAAC;AAErE,MAAM,CAAC,IAAI,CAAC,SAAS,EACnB,8BAAa,CAAC,kBAAkB;AAChC,yCAAyC;AACzC,gCAAc,CAAC,wBAAwB,EACvC,gBAAgB,CAAC,cAAc,EAAE,CAClC,CAAC;AAEF,MAAM,CAAC,GAAG,CAAC,eAAe,EACxB,8BAAa,CAAC,kBAAkB;AAChC,yCAAyC;AACzC,gCAAc,CAAC,wBAAwB,EACvC,gBAAgB,CAAC,cAAc,EAC/B,gBAAgB,CAAC,GAAG,EAAE,CACvB,CAAC;AAEF,MAAM,CAAC,GAAG,CAAC,qBAAqB,EAC9B,8BAAa,CAAC,kBAAkB;AAChC,yCAAyC;AACzC,gCAAc,CAAC,wBAAwB,EACvC,gBAAgB,CAAC,eAAe,CAAC,CAAC,MAAM,CAAC,CAAC,EAC1C,gBAAgB,CAAC,MAAM,CAAC,EAAC,UAAU,EAAE,IAAI,EAAE,YAAY,EAAE,KAAK,EAAE,cAAc,EAAE,IAAI,EAAC,CAAC,EACtF,gBAAgB,CAAC,QAAQ,CAC1B,CAAC;AAEF,MAAM,CAAC,GAAG,CAAC,gBAAgB,EACzB,8BAAa,CAAC,kBAAkB;AAChC,yCAAyC;AACzC,gCAAc,CAAC,wBAAwB,EACvC,gBAAgB,CAAC,eAAe,CAAC,CAAC,MAAM,CAAC,CAAC,EAC1C,gBAAgB,CAAC,GAAG,CAAC,EAAC,UAAU,EAAE,IAAI,EAAE,YAAY,EAAE,KAAK,EAAC,CAAC,EAC7D,gBAAgB,CAAC,QAAQ,CAC1B,CAAC;AAEF,MAAM,CAAC,GAAG,CAAC,mBAAmB,EAC5B,8BAAa,CAAC,kBAAkB,EAChC,gCAAc,CAAC,YAAY,EAC3B,gCAAc,CAAC,cAAc,CAAC,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,EAChD,8BAAa,CAAC,wBAAwB,CAAC,OAAO,CAAC,EAC/C,gBAAgB,CAAC,YAAY,EAC7B,gBAAgB,CAAC,UAAU,CAAC,WAAW,CAAC,CACzC,CAAC;AAEF,MAAM,CAAC,GAAG,CAAC,qBAAqB,EAC9B,8BAAa,CAAC,kBAAkB,EAChC,gCAAc,CAAC,YAAY,EAC3B,gCAAc,CAAC,cAAc,CAAC,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,EAChD,8BAAa,CAAC,wBAAwB,CAAC,OAAO,CAAC,EAC/C,gBAAgB,CAAC,aAAa,EAC9B,gBAAgB,CAAC,UAAU,CAAC,MAAM,CAAC,CACpC,CAAC;AAKF,cAAc;AACd,wCAAwC;AACxC,sCAAsC;AACtC,wCAAwC;AACxC,0BAA0B;AAC1B,KAAK;AAEL,cAAc;AACd,wCAAwC;AACxC,sCAAsC;AACtC,0BAA0B;AAC1B,KAAK;AAEL,MAAM,CAAC,GAAG,CACR,sBAAsB,EACtB,8BAAa,CAAC,kBAAkB,EAChC,gCAAc,CAAC,YAAY,EAC3B,8BAAa,CAAC,aAAa,CAAC,KAAK,CAAC,EAClC,gCAAc,CAAC,oBAAoB,CAAC,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,EACtD,sBAAsB,CAAC,mBAAmB,EAAE,EAC5C,sBAAsB,CAAC,MAAM,EAAE,CAChC,CAAC;AAEF,MAAM,CAAC,IAAI,CACT,sBAAsB,EACtB,8BAAa,CAAC,kBAAkB,EAChC,gCAAc,CAAC,YAAY,EAC3B,8BAAa,CAAC,aAAa,CAAC,KAAK,CAAC,EAClC,gCAAc,CAAC,oBAAoB,CAAC,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,EACtD,8BAAa,CAAC,wBAAwB,CAAC,OAAO,CAAC,EAC/C,+BAAmB,CAAC,SAAS,CAAM,+CAAqB,CAAC,IAAI,CAAC,EAC9D,sBAAsB,CAAC,IAAI,EAAE,CAC9B,CAAC;AAEF,MAAM,CAAC,GAAG,CACR,iCAAiC,EACjC,8BAAa,CAAC,kBAAkB,EAChC,gCAAc,CAAC,YAAY,EAC3B,8BAAa,CAAC,aAAa,CAAC,KAAK,CAAC,EAClC,gCAAc,CAAC,oBAAoB,CAAC,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,EACtD,+BAAmB,CAAC,SAAS,CAAM,+CAAqB,CAAC,IAAI,CAAC,EAC9D,sBAAsB,CAAC,GAAG,EAAE,CAC7B,CAAC;AAEF,MAAM,CAAC,MAAM,CACX,iCAAiC,EACjC,8BAAa,CAAC,kBAAkB,EAChC,gCAAc,CAAC,YAAY,EAC3B,8BAAa,CAAC,aAAa,CAAC,KAAK,CAAC,EAClC,gCAAc,CAAC,oBAAoB,CAAC,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,EACtD,sBAAsB,CAAC,MAAM,EAAE,CAChC,CAAC;AAEW,QAAA,cAAc,GAAW,MAAM,CAAC","sourcesContent":["import { MultipartMiddleware } from './../../middlewares/multipart';\nimport { AuthMiddleware } from './../user/auth.middleware';\nimport { AppMiddleware } from './../app/app.middleware';\nimport { PushPlayerModel } from './push.player.model';\nimport { PushNotificationModel } from './push.notification.model';\nimport { PushControllerMiddleware } from './push.middleware.controller';\nimport { Router } from 'express';\n\nlet debug = require('debug')('app:controller:push');\n\nconst router: Router = Router();\n\nlet notificationController = new PushControllerMiddleware(PushNotificationModel);\nlet playerController = new PushControllerMiddleware(PushPlayerModel);\n\nrouter.post('/player',\n  AppMiddleware.fetchWithPublicKey,\n  // AppMiddleware.addAppIdToBody('appId'),\n  AuthMiddleware.authenticateWithoutError,\n  playerController.registerPlayer()\n);\n\nrouter.put('/player/visit',\n  AppMiddleware.fetchWithPublicKey,\n  // AppMiddleware.addAppIdToBody('appId'),\n  AuthMiddleware.authenticateWithoutError,\n  playerController.setVisitInBody,\n  playerController.put()\n);\n\nrouter.get('/player/:regId/tags',\n  AppMiddleware.fetchWithPublicKey,\n  // AppMiddleware.addAppIdToBody('appId'),\n  AuthMiddleware.authenticateWithoutError,\n  playerController.allowOnlyInBody(['tags']),\n  playerController.getOne({ignoreSend: true, ignoreOutput: false, ignoreDownload: true}),\n  playerController.sendTags\n);\n\nrouter.put('/player/:regId',\n  AppMiddleware.fetchWithPublicKey,\n  // AppMiddleware.addAppIdToBody('appId'),\n  AuthMiddleware.authenticateWithoutError,\n  playerController.allowOnlyInBody(['tags']),\n  playerController.put({ignoreSend: true, ignoreOutput: false}),\n  playerController.sendTags\n);\n\nrouter.get('/:appId/player/nb',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  AuthMiddleware.allowOnlyRoles(['admin', 'push']),\n  AppMiddleware.addAppIdFromParamsToBody('appId'),\n  playerController.getNbPlayers,\n  playerController.sendLocals('nbPlayers')\n);\n\nrouter.get('/:appId/player/tags',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  AuthMiddleware.allowOnlyRoles(['admin', 'push']),\n  AppMiddleware.addAppIdFromParamsToBody('appId'),\n  playerController.getPlayerTags,\n  playerController.sendLocals('tags')\n);\n\n\n\n\n// router.get(\n//   ControllerMiddleware.getAllRoute(),\n//   AppMiddleware.fetchWithPublicKey,\n//   mdController.prepareQueryFromReq(),\n//   mdController.getAll()\n// );\n\n// router.get(\n//   ControllerMiddleware.getOneRoute(),\n//   AppMiddleware.fetchWithPublicKey,\n//   mdController.getOne()\n// );\n\nrouter.get(\n  '/:appId/notification',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  AppMiddleware.fetchParamApp(false),\n  AuthMiddleware.checkRoleViaParamApp(['admin', 'push']),\n  notificationController.prepareQueryFromReq(),\n  notificationController.getAll()\n);\n\nrouter.post(\n  '/:appId/notification',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  AppMiddleware.fetchParamApp(false),\n  AuthMiddleware.checkRoleViaParamApp(['admin', 'push']),\n  AppMiddleware.addAppIdFromParamsToBody('appId'),\n  MultipartMiddleware.parseDeco(<any>PushNotificationModel.deco),\n  notificationController.post()\n);\n\nrouter.put(\n  '/:appId/notification/:elementId',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  AppMiddleware.fetchParamApp(false),\n  AuthMiddleware.checkRoleViaParamApp(['admin', 'push']),\n  MultipartMiddleware.parseDeco(<any>PushNotificationModel.deco),\n  notificationController.put()\n);\n\nrouter.delete(\n  '/:appId/notification/:elementId',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  AppMiddleware.fetchParamApp(false),\n  AuthMiddleware.checkRoleViaParamApp(['admin', 'push']),\n  notificationController.delete()\n);\n\nexport const PushController: Router = router;"]}