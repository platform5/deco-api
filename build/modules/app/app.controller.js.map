{"version":3,"file":"app.controller.js","sourceRoot":"","sources":["../../../src/modules/app/app.controller.ts"],"names":[],"mappings":"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","sourcesContent":["import { Router } from 'express';\nimport { ControllerMiddleware, MultipartMiddleware } from '../../';\nimport { AppModel } from './app.model';\nimport { AppControllerMiddleware} from './app.middleware.controller';\nimport { AppMiddleware } from './app.middleware';\nimport { AuthMiddleware } from '../user/auth.middleware';\nlet debug = require('debug')('app:controller:app');\n\nconst router: Router = Router();\n\n//let mdController = new ControllerMiddleware(AppModel);\nlet mdController = new AppControllerMiddleware(AppModel);\nmdController.readByCreator = false;\nmdController.writeByCreator = false;\n\nmdController.readByUsersRoles = true;\nmdController.writeByUsersRoles = true;\nmdController.readUsersRoles = ['admin'];\nmdController.writeUsersRoles = ['admin'];\n\nrouter.get(\n  ControllerMiddleware.getAllRoute(),\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  mdController.prepareQueryFromReq(),\n  mdController.getAll()\n);\n\nrouter.get(\n  ControllerMiddleware.getOneRoute(), \n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  mdController.getOne()\n);\n\nrouter.get(\n  ControllerMiddleware.getOneRoute() + '/stats', \n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  AuthMiddleware.checkUserRoleAccess('adminUserRoles'),\n  mdController.getOne()\n);\n\nrouter.get(\n  ControllerMiddleware.getOneRoute() + '/key/:type/:index',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  mdController.getOne({ignoreOutput: true, ignoreSend: true, ignoreDownload: true}),\n  AppMiddleware.outputKey()\n)\n\nrouter.post(\n  ControllerMiddleware.getOneRoute() + '/key/:type',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  mdController.getOne({ignoreOutput: true, ignoreSend: true, ignoreDownload: true}),\n  AppMiddleware.createKey(),\n  mdController.sendLocals('element', true)\n);\n\nrouter.put(\n  ControllerMiddleware.getOneRoute() + '/key/:type/:index/:last4',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  mdController.getOne({ignoreOutput: true, ignoreSend: true, ignoreDownload: true}),\n  AppMiddleware.editKey(),\n  mdController.sendLocals('element', true)\n);\n\nrouter.delete(\n  ControllerMiddleware.getOneRoute() + '/key/:type/:index/:last4',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  mdController.getOne({ignoreOutput: true, ignoreSend: true, ignoreDownload: true}),\n  AppMiddleware.deleteKey(),\n  mdController.sendLocals('element', true)\n);\n\nrouter.post(\n  '/:appId/user/:userId',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  AppMiddleware.fetchParamApp(),\n  AuthMiddleware.checkRoleViaParamApp('admin'),\n  AppMiddleware.addUser(),\n  mdController.sendLocals('element', true)\n);\n\nrouter.put(\n  '/:appId/user/:userId',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  AppMiddleware.fetchParamApp(),\n  AuthMiddleware.checkRoleViaParamApp(['admin', 'user']),\n  AppMiddleware.editUser(),\n  mdController.sendLocals('element', false)\n);\n\nrouter.put(\n  '/:appId/parent-user/:userId',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  AppMiddleware.fetchParamApp(),\n  AuthMiddleware.checkRoleViaParamApp('admin'),\n  AppMiddleware.editParentUser(),\n  mdController.sendLocals('element', false)\n);\n\nrouter.delete(\n  '/:appId/user/:userId',\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  AppMiddleware.fetchParamApp(),\n  AuthMiddleware.checkRoleViaParamApp('admin'),\n  AppMiddleware.removeUser(),\n  mdController.sendLocals('element', true)\n);\n\nrouter.post(\n  ControllerMiddleware.postRoute(),\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  // AppMiddleware.addAppIdToBody('appId'),\n  MultipartMiddleware.parseDeco(<any>AppModel.deco),\n  mdController.post()\n);\n\nrouter.put(\n  ControllerMiddleware.putRoute(),\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  // AppMiddleware.addAppIdToBody('appId'),\n  MultipartMiddleware.parseDeco(<any>AppModel.deco),\n  mdController.put()\n);\n\nrouter.delete(\n  ControllerMiddleware.deleteRoute(),\n  AppMiddleware.fetchWithPublicKey,\n  AuthMiddleware.authenticate,\n  mdController.delete()\n);\n\nexport const AppController: Router = router;"]}